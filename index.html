<!doctype html>
<html lang="ar" dir="rtl" data-theme="neon" data-mode="night" data-contrast="normal">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#05070F">
  <title>Ø§Ù ØªØ³Ø¹ÙŠÙ† Ù„Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙÙ†ÙŠ | F90 Music</title>
  <style>
/* ===== Themes (7) via CSS variables ===== */
:root{
  --bg:#05070F; --panel:rgba(10,14,30,.86); --txt:#EAF0FF; --muted:rgba(234,240,255,.65);
  --br:rgba(255,255,255,.10); --shadow:0 10px 35px rgba(0,0,0,.55); --r:18px; --miniH:86px;
  --acc:#7C5CFF; --acc2:#21D4FD; --glow:rgba(124,92,255,.35);
}
html[data-theme="neon"]  { --acc:#7C5CFF; --acc2:#21D4FD; --glow:rgba(124,92,255,.35); }
html[data-theme="cyan"]  { --acc:#00E5FF; --acc2:#00FFA3; --glow:rgba(0,229,255,.30); }
html[data-theme="purple"]{ --acc:#B24BFF; --acc2:#FF4BD8; --glow:rgba(178,75,255,.28); }
html[data-theme="gold"]  { --acc:#FFB800; --acc2:#FF5C00; --glow:rgba(255,184,0,.22); }
html[data-theme="red"]   { --acc:#FF2A6D; --acc2:#FFB000; --glow:rgba(255,42,109,.22); }
html[data-theme="green"] { --acc:#00FFA3; --acc2:#2DFF5C; --glow:rgba(0,255,163,.20); }
html[data-theme="mono"]  { --acc:#EAF0FF; --acc2:#AAB3D1; --glow:rgba(234,240,255,.12); }

/* Night/Day */
html[data-mode="day"]{
  --bg:#F7F8FF; --panel:rgba(255,255,255,.88); --txt:#0B1020;
  --muted:rgba(11,16,32,.65); --br:rgba(11,16,32,.10);
  --shadow:0 10px 30px rgba(11,16,32,.18);
}

/* High Contrast */
html[data-contrast="high"]{ --muted:rgba(234,240,255,.92); }
html[data-mode="day"][data-contrast="high"]{
  --muted:rgba(11,16,32,.92); --br:rgba(11,16,32,.18);
}

/* Motion */
html[data-motion="off"] *{ animation:none !important; transition:none !important; }

*{ box-sizing:border-box; }
html,body{ margin:0; padding:0; background:var(--bg); color:var(--txt); font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; width:100%; }
a{ color:inherit; text-decoration:none; }
button,input,select,textarea{ font:inherit; }
img{ max-width:100%; height:auto; display:block; }
.small{ color:var(--muted); font-size:12px; }

.wrap{ width: min(1200px, calc(100% - 24px)); margin: 0 auto; }

.bgFX{
  position:fixed; inset:0; pointer-events:none; z-index:-1;
  background:
    radial-gradient(900px 500px at 20% 10%, var(--glow), transparent 60%),
    radial-gradient(700px 420px at 80% 20%, rgba(33,212,253,.12), transparent 60%),
    radial-gradient(900px 520px at 50% 90%, rgba(255,255,255,.06), transparent 60%);
  filter:saturate(1.06);
}

/* Topbar */
.topbar{ position:sticky; top:0; z-index:50; background:rgba(5,7,15,.86); backdrop-filter: blur(10px); border-bottom:1px solid var(--br); }
html[data-mode="day"] .topbar{ background:rgba(247,248,255,.84); }
.topbarInner{ display:flex; align-items:center; justify-content:space-between; padding:12px 0; gap:10px; }

.brand{ display:flex; align-items:center; gap:10px; cursor:pointer; }
.logoWrap{ position:relative; width:46px; height:46px; }
.logo{
  width:46px; height:46px; border-radius:16px; display:grid; place-items:center;
  background:rgba(255,255,255,.06); border:1px solid var(--br); font-weight:900;
  box-shadow:0 0 0 1px rgba(255,255,255,.05) inset;
}
html[data-mode="day"] .logo{ background:rgba(0,0,0,.03); }
.headphones{
  position:absolute; inset:-3px;
  border-radius:18px;
  border:2px solid transparent;
  background:
    radial-gradient(12px 12px at 15% 60%, rgba(255,255,255,.14), transparent 60%),
    radial-gradient(12px 12px at 85% 60%, rgba(255,255,255,.14), transparent 60%);
  box-shadow: 0 0 22px var(--glow);
  animation: hpPulse 1.4s ease-in-out infinite;
}
@keyframes hpPulse{ 0%,100%{ transform:scale(1); opacity:.85 } 50%{ transform:scale(1.04); opacity:1 } }
.brandTitle{ font-weight:900; }
.brandSub{ color:var(--muted); font-size:12px; margin-top:2px; }
.topActions{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }

/* Buttons */
.btn{
  border:1px solid var(--br);
  background:rgba(255,255,255,.04);
  color:var(--txt);
  padding:10px 12px;
  border-radius:14px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
html[data-mode="day"] .btn{ background:rgba(0,0,0,.03); }
.btn:hover{ background:rgba(255,255,255,.06); }
html[data-mode="day"] .btn:hover{ background:rgba(0,0,0,.05); }
.btn.primary{
  border-color:rgba(255,255,255,.18);
  background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, 0 10px 25px rgba(0,0,0,.25);
}
html[data-mode="day"] .btn.primary{
  border-color:rgba(11,16,32,.16);
  box-shadow: 0 0 0 1px rgba(11,16,32,.06) inset, 0 10px 25px rgba(11,16,32,.12);
}
.pill{ border-radius:999px !important; padding-inline:14px; }
.btn.on{
  border-color:rgba(255,255,255,.18);
  box-shadow:0 0 18px var(--glow);
  background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
}

/* Layout */
.app{ display:grid; grid-template-columns: 320px 1fr; gap:16px; padding:18px 0 calc(var(--miniH) + 22px); }
.sidebar{ background:var(--panel); border:1px solid var(--br); border-radius:var(--r); padding:14px; box-shadow:var(--shadow); height:fit-content; position:sticky; top:78px; }
.sideTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
.sideNav{ display:grid; gap:8px; margin:10px 0; }
.sideNav a{ padding:10px 12px; border-radius:14px; border:1px solid var(--br); background:rgba(255,255,255,.03); }
.sideNav a:hover{ background:rgba(255,255,255,.06); border-color:rgba(255,255,255,.16); }
html[data-mode="day"] .sideNav a{ background:rgba(0,0,0,.03); }
html[data-mode="day"] .sideNav a:hover{ background:rgba(0,0,0,.05); }
.sideCard{ margin-top:12px; padding:12px; border:1px solid var(--br); border-radius:var(--r); background:rgba(255,255,255,.03); }
html[data-mode="day"] .sideCard{ background:rgba(0,0,0,.03); }
.sideCardTitle{ font-weight:900; margin-bottom:10px; }
.sideLinks{ display:flex; flex-wrap:wrap; gap:8px; }
.hr{ height:1px; background:var(--br); margin:12px 0; }
.sideFoot{ margin-top:12px; color:var(--muted); font-size:12px; }

.viewHeader{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:12px; }
.vhTitle{ margin:6px 0 0; font-size:28px; }

/* Back Button */
.backBtn{
  display:none;
  position:sticky;
  top:74px;
  z-index:20;
  margin:8px 0 10px;
  width:fit-content;
  border:1px solid var(--br);
  background:rgba(255,255,255,.04);
  color:var(--txt);
  padding:10px 14px;
  border-radius:999px;
  cursor:pointer;
}
.backBtn.show{ display:inline-flex; align-items:center; gap:8px; }
.backBtn.showAlways{ display:inline-flex; }

/* Home Pro */
.homePro{ display:block; }
.heroPro{
  position:relative;
  border:1px solid var(--br);
  border-radius:var(--r);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  box-shadow:var(--shadow);
  overflow:hidden;
}
.heroGlow{
  position:absolute; inset:-40%;
  background:
    radial-gradient(closest-side at 30% 30%, var(--glow), transparent 60%),
    radial-gradient(closest-side at 70% 40%, rgba(33,212,253,.12), transparent 60%);
  filter:blur(20px);
  opacity:.9;
  animation: glowDrift 5s ease-in-out infinite;
}
@keyframes glowDrift{ 0%,100%{ transform:translate3d(0,0,0) } 50%{ transform:translate3d(30px,-12px,0) } }
.heroProInner{ position:relative; padding:16px; }
.heroTitle{ margin:10px 0 6px; font-size:24px; }
.heroDesc{ margin:0 0 14px; color:var(--muted); }
.heroBtns{ display:flex; flex-wrap:wrap; gap:8px; }

.heroStats{ display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top:14px; }
.stat{ padding:10px; border:1px solid var(--br); border-radius:var(--r); background:rgba(0,0,0,.12); }
html[data-mode="day"] .stat{ background:rgba(0,0,0,.03); }
.statNum{ font-size:18px; font-weight:900; }
.statLbl{ color:var(--muted); font-size:12px; margin-top:4px; }

.eqPro{ display:flex; gap:6px; margin-top:14px; align-items:flex-end; height:22px; }
.eqPro span{
  width:8px; border-radius:999px;
  background:linear-gradient(180deg, var(--acc), rgba(255,255,255,.12));
  opacity:.9;
  animation:eqMove 1.2s ease-in-out infinite;
}
.eqPro span:nth-child(2){ animation-delay:.1s }
.eqPro span:nth-child(3){ animation-delay:.2s }
.eqPro span:nth-child(4){ animation-delay:.3s }
.eqPro span:nth-child(5){ animation-delay:.4s }
.eqPro span:nth-child(6){ animation-delay:.5s }
.eqPro span:nth-child(7){ animation-delay:.6s }
@keyframes eqMove{ 0%,100%{ height:6px } 50%{ height:22px } }

.sectionHead{ margin:16px 0 10px; display:flex; align-items:flex-end; justify-content:space-between; gap:10px; }
.sectionHead h3{ margin:0; font-size:18px; }

/* Rows */
.row{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
.rowCard{
  cursor:pointer;
  border:1px solid var(--br);
  border-radius:var(--r);
  overflow:hidden;
  background:rgba(255,255,255,.03);
  box-shadow:var(--shadow);
}
html[data-mode="day"] .rowCard{ background:rgba(0,0,0,.03); }
.rowThumb{ width:100%; aspect-ratio:16/9; object-fit:cover; display:block; }
.rowBody{ padding:10px; }
.rowTitle{ margin:0; font-weight:900; }
.rowMeta{ margin:8px 0 0; color:var(--muted); font-size:12px; }

/* Toolbar + Grid */
.toolbar{ display:flex; gap:10px; margin:14px 0; flex-wrap:wrap; }
.input, .select, .textarea{
  width:100%;
  border:1px solid var(--br);
  background:rgba(255,255,255,.03);
  color:var(--txt);
  padding:12px 12px;
  border-radius:14px;
  outline:none;
}
html[data-mode="day"] .input, html[data-mode="day"] .select, html[data-mode="day"] .textarea{ background:rgba(0,0,0,.03); }
.textarea{ min-height:90px; resize:vertical; }
.select{ width:220px; }

.grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
.item{ cursor:pointer; border:1px solid var(--br); border-radius:var(--r); overflow:hidden; background:rgba(255,255,255,.03); box-shadow:var(--shadow); }
html[data-mode="day"] .item{ background:rgba(0,0,0,.03); }
.thumb{ width:100%; display:block; aspect-ratio:16/9; object-fit:cover; }
.itemBody{ padding:10px; }
.itemTitle{ margin:0; font-weight:900; line-height:1.35; }
.itemMeta{ margin:8px 0 0; color:var(--muted); font-size:12px; }
.badge{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px;
  border:1px solid var(--br);
  background:rgba(0,0,0,.18);
  color:var(--txt);
  font-size:12px;
}
html[data-mode="day"] .badge{ background:rgba(0,0,0,.05); }
.foot{ margin-top:18px; padding:10px 0; }

/* Drawer */
.drawerOverlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.55);
  opacity:0;
  pointer-events:none;
  transition:opacity .15s ease;
  z-index:9998;
}
.drawer{
  position:fixed; top:0; bottom:0; right:0;
  width:330px; max-width:86vw;
  background:var(--panel);
  border-left:1px solid var(--br);
  box-shadow:var(--shadow);
  transform:translateX(110%);
  transition:transform .15s ease;
  z-index:9999;
  padding:14px;
  visibility:hidden;
  pointer-events:none;
}
.drawer.open{
  transform:translateX(0);
  visibility:visible;
  pointer-events:auto;
}
.drawerOverlay.open{
  opacity:1;
  pointer-events:auto;
}

/* Modal (themes) */
.modalOverlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.55);
  opacity:0; pointer-events:none;
  transition:opacity .15s ease;
  z-index:9000;
}
.modal{
  position:fixed;
  left:50%;
  top:74px;
  transform:translateX(-50%);
  width:min(560px, 92vw);
  max-height: calc(100vh - 110px);
  overflow:auto;
  border:1px solid var(--br);
  border-radius:var(--r);
  background:var(--panel);
  box-shadow:var(--shadow);
  padding:14px;
  opacity:0;
  pointer-events:none;
  transition:opacity .15s ease, transform .15s ease;
  z-index:9001;
}
.modal.open{ opacity:1; pointer-events:auto; transform:translateX(-50%); }
.modalOverlay.open{ opacity:1; pointer-events:auto; }
.modalHead{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
.themeGrid{ display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
.themeSwatch{
  border:1px solid var(--br);
  border-radius:14px;
  padding:10px;
  background:rgba(255,255,255,.03);
  cursor:pointer;
  text-align:right;
}
html[data-mode="day"] .themeSwatch{ background:rgba(0,0,0,.03); }
.swTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.swDot{ width:18px; height:18px; border-radius:999px; background:var(--acc); box-shadow:0 0 18px var(--glow); }
.swName{ font-weight:900; font-size:13px; }
.swBar{ margin-top:10px; height:10px; border-radius:999px; background:linear-gradient(90deg, var(--acc), var(--acc2)); opacity:.9; }
.modalHint{ margin-top:10px; }

@media (max-width: 520px){
  .modal{ top:64px; width:92vw; max-height: calc(100vh - 90px); }
  .themeGrid{ grid-template-columns: repeat(2, 1fr); }
}

/* Song View (Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø©) */
.songView{ display:none; padding:18px 0 calc(var(--miniH) + 22px); }
.songView.show{ display:block; }
.songCard{
  background:rgba(255,255,255,.03);
  border:1px solid var(--br);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  overflow:hidden;
}
html[data-mode="day"] .songCard{ background:rgba(0,0,0,.03); }
.songHead{
  padding:14px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
  border-bottom:1px solid var(--br);
}
.songTitle{ margin:8px 0 0; font-size:22px; }
.songBtns{ display:flex; gap:8px; flex-wrap:wrap; }
.playerBox{ padding:14px; }
.ytBox{
  width:100%;
  aspect-ratio:16/9;
  border-radius:14px;
  overflow:hidden;
  background:#000;
  border:1px solid var(--br);
}
#ytPlayer{ width:100%; height:100%; border:0; }

.rateCard, .commentsCard, .suggestCard{
  margin:0 14px 14px;
  border:1px solid var(--br);
  border-radius:var(--r);
  background:rgba(0,0,0,.12);
  padding:12px;
}
html[data-mode="day"] .rateCard, html[data-mode="day"] .commentsCard, html[data-mode="day"] .suggestCard{ background:rgba(0,0,0,.03); }
.rateHead, .commentsHead, .suggestHead{ display:flex; align-items:flex-end; justify-content:space-between; gap:10px; }
.rateTitle, .commentsTitle, .suggestTitle{ font-weight:900; }
.stars{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
.starBtn{
  width:42px; height:42px;
  border-radius:14px;
  border:1px solid var(--br);
  background:rgba(255,255,255,.03);
  cursor:pointer;
  display:grid; place-items:center;
  font-size:18px;
}
html[data-mode="day"] .starBtn{ background:rgba(0,0,0,.03); }
.starBtn.active{
  border-color:rgba(255,255,255,.20);
  box-shadow:0 0 22px var(--glow);
  background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
}
.cmForm{ display:grid; gap:10px; margin-top:12px; }
.cmActions{ display:flex; gap:8px; flex-wrap:wrap; }
.cmList{ margin-top:12px; display:grid; gap:10px; }
.cmItem{
  border:1px solid var(--br);
  border-radius:14px;
  background:rgba(255,255,255,.03);
  padding:10px;
}
html[data-mode="day"] .cmItem{ background:rgba(0,0,0,.03); }
.cmTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.cmName{ font-weight:900; font-size:13px; }
.cmTime{ color:var(--muted); font-size:12px; }
.cmText{ margin-top:8px; color:var(--txt); line-height:1.6; }
.cmDel{ padding:6px 10px; border-radius:999px; }

.suggestGrid{ margin-top:12px; display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
.sCard{ cursor:pointer; border:1px solid var(--br); border-radius:14px; background:rgba(255,255,255,.03); overflow:hidden; }
html[data-mode="day"] .sCard{ background:rgba(0,0,0,.03); }
.sThumb{ width:100%; aspect-ratio:16/9; object-fit:cover; display:block; background:#000; }
.sBody{ padding:10px; }
.sTitle{ margin:0; font-weight:900; font-size:13px; line-height:1.4; }
.sMeta{ margin-top:6px; color:var(--muted); font-size:12px; }

/* Mini Player */
.mini{
  position:fixed; left:0; right:0; bottom:0;
  height:var(--miniH);
  z-index:60;
  background:rgba(5,7,15,.86);
  backdrop-filter: blur(12px);
  border-top:1px solid var(--br);
  display:grid;
  grid-template-columns: 1fr 1.25fr 1fr;
  align-items:center;
  padding:10px 12px;
  gap:10px;
}
html[data-mode="day"] .mini{ background:rgba(247,248,255,.86); }
.miniLeft{ min-width:0; }
.miniTitle{ font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.miniMeta{ color:var(--muted); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.miniMid{ display:flex; align-items:center; justify-content:center; gap:10px; flex-wrap:wrap; }
.miniBtns{ display:flex; gap:8px; }
.miniToggles{ display:flex; gap:8px; }
.miniRight{ display:flex; justify-content:flex-end; }
.volWrap{ display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:999px; border:1px solid var(--br); background:rgba(255,255,255,.03); }
html[data-mode="day"] .volWrap{ background:rgba(0,0,0,.03); }
.volIco{ font-size:14px; }
.volRange{ width:140px; }

/* âœ… Mobile */
@media (max-width: 980px){
  .app{ grid-template-columns: 1fr; }
  .sidebar{ display:none; }
  .grid{ grid-template-columns: repeat(2, 1fr); }
  .mobileOnly{ display:inline-flex; }
  .mini{ grid-template-columns: 1fr; height:auto; padding:10px 12px; }
  .miniRight{ justify-content:flex-start; }
  .wrap{ width: calc(100% - 20px); }
  .heroProInner{ padding:14px; }
  .heroTitle{ font-size:22px; line-height:1.25; }
  .heroBtns .btn{ width:100%; }
  .heroStats{ grid-template-columns: repeat(2, 1fr); }
  .row{
    display:flex;
    gap:12px;
    overflow:auto;
    padding-bottom:6px;
    scroll-snap-type:x mandatory;
  }
  .rowCard{
    min-width: 84vw;
    scroll-snap-align:start;
  }
}
@media (max-width: 520px){
  .grid{ grid-template-columns: 1fr; }
  .select{ width:160px; }
  .suggestGrid{ grid-template-columns: 1fr; }
  .volRange{ width:120px; }
}
.mobileOnly{ display:none; }
  </style>
</head>
<body>
  <div class="bgFX"></div>

  <!-- Topbar -->
  <header class="topbar">
    <div class="wrap topbarInner">
      <div class="brand" id="goHome" role="button" tabindex="0">
        <div class="logoWrap" aria-hidden="true">
          <div class="logo">F90</div>
          <div class="headphones"></div>
        </div>
        <div class="brandTxt">
          <div class="brandTitle">Ø§Ù ØªØ³Ø¹ÙŠÙ† Ù„Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙÙ†ÙŠ</div>
          <div class="brandSub">F90 Music â€” Official</div>
        </div>
      </div>

      <div class="topActions">
        <button class="btn pill mobileOnly" id="drawerBtn" type="button" aria-label="menu">â˜°</button>
        <button class="btn pill" id="modeBtn" type="button" title="Ù„ÙŠÙ„ÙŠ/Ù†Ù‡Ø§Ø±ÙŠ">Ù†Ù‡Ø§Ø±ÙŠ</button>
        <button class="btn pill" id="contrastBtn" type="button" title="ØªØ¨Ø§ÙŠÙ† Ø¹Ø§Ù„ÙŠ">ØªØ¨Ø§ÙŠÙ†</button>
        <button class="btn pill" id="themeBtn" type="button" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ†">Ø£Ù„ÙˆØ§Ù†</button>
        <button class="btn pill" id="motionBtn" type="button" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø±ÙƒØ©">Ø­Ø±ÙƒØ©</button>
        <a class="btn primary" data-link="youtube" target="_blank" rel="noopener">Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨</a>
      </div>
    </div>
  </header>

  <!-- Theme Panel -->
  <div class="modalOverlay" id="themeOverlay"></div>
  <section class="modal" id="themeModal" aria-label="Ø§Ù„Ø«ÙŠÙ…Ø§Øª">
    <div class="modalHead">
      <div class="pill">Ø§Ù„Ø«ÙŠÙ…Ø§Øª (7)</div>
      <button class="btn pill" id="closeTheme" type="button">âœ•</button>
    </div>
    <div class="themeGrid" id="themeGrid"></div>
    <div class="small modalHint">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</div>
  </section>

  <!-- Drawer -->
  <div class="drawerOverlay" id="drawerOverlay"></div>
  <aside class="drawer" id="drawer">
    <div class="sideTop">
      <div class="pill">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
      <button class="btn pill" id="closeDrawer" type="button">âœ•</button>
    </div>

    <nav class="sideNav">
      <a href="#/home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="#/all">ÙƒÙ„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ</a>
      <a href="#/top">Ø£ÙØ¶Ù„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ</a>
      <a href="#/rap">Ø§Ù„Ø±Ø§Ø¨</a>
      <a href="#/sad">Ø±ÙˆÙ…Ù†Ø³ÙŠ/Ø­Ø²ÙŠÙ†/Ø·Ø±Ø¨ÙŠ</a>
      <a href="#/fav">Ù…ÙØ¶Ù„ØªÙŠ</a>
    </nav>

    <div class="sideCard">
      <div class="sideCardTitle">ØªÙˆØ§ØµÙ„</div>
      <div class="sideLinks">
        <a class="btn" data-link="tiktok" target="_blank" rel="noopener">TikTok</a>
        <a class="btn" data-link="insta" target="_blank" rel="noopener">Instagram</a>
        <a class="btn primary" data-link="whatsapp" target="_blank" rel="noopener">WhatsApp</a>
        <a class="btn" data-link="email">Email</a>
      </div>
    </div>

    <div class="sideFoot">
      <div class="small">Â© <span id="yearM"></span> F90</div>
    </div>
  </aside>

  <!-- ====== Index App ====== -->
  <main class="wrap app" id="indexApp">
    <!-- Desktop Sidebar -->
    <aside class="sidebar">
      <div class="sideTop">
        <div class="pill">F90</div>
        <div class="small" id="statsMini">â€”</div>
      </div>

      <nav class="sideNav">
        <a href="#/home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="#/all">ÙƒÙ„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ</a>
        <a href="#/top">Ø£ÙØ¶Ù„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ</a>
        <a href="#/rap">Ø§Ù„Ø±Ø§Ø¨</a>
        <a href="#/sad">Ø±ÙˆÙ…Ù†Ø³ÙŠ/Ø­Ø²ÙŠÙ†/Ø·Ø±Ø¨ÙŠ</a>
        <a href="#/fav">Ù…ÙØ¶Ù„ØªÙŠ</a>
      </nav>

      <div class="sideCard">
        <div class="sideCardTitle">Ø±ÙˆØ§Ø¨Ø· Ø±Ø³Ù…ÙŠØ©</div>
        <div class="sideLinks">
          <a class="btn primary" data-link="youtube" target="_blank" rel="noopener">Ø§Ø´ØªØ±Ùƒ Ø¨Ø§Ù„Ù‚Ù†Ø§Ø©</a>
          <a class="btn" data-link="tiktok" target="_blank" rel="noopener">TikTok</a>
          <a class="btn" data-link="insta" target="_blank" rel="noopener">Instagram</a>
        </div>
        <div class="hr"></div>
        <div class="sideCardTitle">Ø·Ù„Ø¨ Ø£ØºÙ†ÙŠØ©</div>
        <div class="sideLinks">
          <a class="btn primary" data-link="whatsapp" target="_blank" rel="noopener">WhatsApp</a>
          <a class="btn" data-link="email">Email</a>
        </div>
      </div>

      <div class="sideFoot">
        <div class="small">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø·Ø¨Ø¹ ÙˆØ§Ù„Ù†Ø´Ø± Ù…Ø­ÙÙˆØ¸Ø© Â© <span id="year"></span> F90</div>
      </div>
    </aside>

    <!-- Main -->
    <section class="main">
      <div class="viewHeader">
        <div class="vhLeft">
          <div class="pill" id="viewPill">F90</div>
          <h1 class="vhTitle" id="viewTitle">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
          <div class="small" id="viewSubtitle">â€”</div>
        </div>
        <div class="vhRight">
          <button class="btn" id="refreshBtn" type="button">ØªØ­Ø¯ÙŠØ«</button>
          <button class="btn" id="shareBtn" type="button">Ù†Ø³Ø® Ø±Ø§Ø¨Ø·</button>
        </div>
      </div>

      <button class="backBtn" id="backBtnIndex" type="button" title="Ø±Ø¬ÙˆØ¹">âŸµ Ø±Ø¬ÙˆØ¹</button>

      <section class="homePro" id="homePro">
        <section class="heroPro">
          <div class="heroGlow"></div>
          <div class="heroProInner">
            <div class="pill">F90 â€¢ Music</div>
            <h2 class="heroTitle">Ø£ØºØ§Ù†ÙŠ F90 â€” ØªØ´ØºÙŠÙ„ Ø³Ø±ÙŠØ¹ ÙˆØªØµÙ†ÙŠÙ Ù…Ù†Ø¸Ù…</h2>
            <p class="heroDesc">ÙƒÙ„ Ø¬Ø¯ÙŠØ¯ ÙŠØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ â€” ÙˆÙ‚ÙŠÙ‘Ù… Ø§Ù„Ø£ØºØ§Ù†ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹.</p>

            <div class="heroBtns">
              <button class="btn primary" data-navto="#/all" type="button">ÙƒÙ„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ</button>
              <button class="btn" data-navto="#/top" type="button">Ø£ÙØ¶Ù„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ</button>
              <button class="btn" data-navto="#/rap" type="button">Ø§Ù„Ø±Ø§Ø¨</button>
              <button class="btn" data-navto="#/sad" type="button">Ø±ÙˆÙ…Ù†Ø³ÙŠ/Ø­Ø²ÙŠÙ†/Ø·Ø±Ø¨ÙŠ</button>
              <button class="btn pill" data-navto="#/fav" type="button">Ù…ÙØ¶Ù„ØªÙŠ</button>
            </div>

            <div class="heroStats">
              <div class="stat">
                <div class="statNum" id="totalTracks">â€”</div>
                <div class="statLbl">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØºØ§Ù†ÙŠ</div>
              </div>
              <div class="stat">
                <div class="statNum" id="latestTrack">â€”</div>
                <div class="statLbl">Ø¢Ø®Ø± Ø¥ØµØ¯Ø§Ø±</div>
              </div>
              <div class="stat">
                <div class="statNum" id="topRated">â€”</div>
                <div class="statLbl">Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…</div>
              </div>
            </div>

            <div class="eqPro" aria-hidden="true">
              <span></span><span></span><span></span><span></span><span></span><span></span><span></span>
            </div>

            <div class="small" id="homeStatus"></div>
          </div>
        </section>

        <section class="sectionHead">
          <h3>Ø£Ø­Ø¯Ø« Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª</h3>
          <div class="small">Ø¢Ø®Ø± Ù…Ø§ Ù†Ø²Ù„</div>
        </section>
        <section class="row" id="latestRow"></section>

        <section class="sectionHead">
          <h3>Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</h3>
          <div class="small">Ø­Ø³Ø¨ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
        </section>
        <section class="row" id="topRow"></section>
      </section>

      <section class="toolbar" id="toolbar">
        <input class="input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø£ØºÙ†ÙŠØ©..." />
        <select class="select" id="sortSelect">
          <option value="date_desc">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
          <option value="date_asc">Ø§Ù„Ø£Ù‚Ø¯Ù…</option>
          <option value="rating_desc">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</option>
          <option value="title_asc">A-Z</option>
        </select>
      </section>

      <section class="grid" id="grid"></section>

      <footer class="foot">
        <div class="small">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø·Ø¨Ø¹ ÙˆØ§Ù„Ù†Ø´Ø± Ù…Ø­ÙÙˆØ¸Ø© Â© <span id="yearF"></span> F90</div>
      </footer>
    </section>
  </main>

  <!-- ====== Song View (Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù) ====== -->
  <main class="songView" id="songView">
    <div class="wrap">
      <button class="backBtn showAlways" id="backBtnSong" type="button" title="Ø±Ø¬ÙˆØ¹">âŸµ Ø±Ø¬ÙˆØ¹</button>

      <section class="songCard">
        <div class="songHead">
          <div>
            <div class="pill" id="songPill">F90</div>
            <h1 class="songTitle" id="songTitle">â€”</h1>
            <div class="small" id="songMeta">â€”</div>
          </div>
          <div class="songBtns">
            <button class="btn pill" id="favBtn" type="button">â­ Ù…ÙØ¶Ù„Ø©</button>
            <button class="btn pill" id="copyBtn" type="button">Ù†Ø³Ø® Ø±Ø§Ø¨Ø·</button>
          </div>
        </div>

        <div class="playerBox">
          <div class="ytBox">
            <iframe id="ytPlayer" title="YouTube Player"
              allow="autoplay; encrypted-media; picture-in-picture"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen></iframe>
          </div>
        </div>

        <section class="rateCard">
          <div class="rateHead">
            <div class="rateTitle">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£ØºÙ†ÙŠØ©</div>
            <div class="small" id="rateText">â€”</div>
          </div>
          <div class="stars" id="stars"></div>
        </section>

        <section class="commentsCard">
          <div class="commentsHead">
            <div class="commentsTitle">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
            <div class="small" id="cmCount">â€”</div>
          </div>

          <div class="cmForm">
            <input class="input" id="cmName" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
            <textarea class="textarea" id="cmText" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..."></textarea>
            <div class="cmActions">
              <button class="btn primary" id="cmAdd" type="button">Ù†Ø´Ø±</button>
              <button class="btn" id="cmClear" type="button">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
            </div>
          </div>

          <div class="cmList" id="cmList"></div>
        </section>

        <section class="suggestCard">
          <div class="suggestHead">
            <div class="suggestTitle">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</div>
            <div class="small">Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
          </div>
          <div class="suggestGrid" id="suggestGrid"></div>
        </section>

        <div class="small" id="songNote" style="padding:0 14px 14px;"></div>
      </section>
    </div>
  </main>

  <!-- Mini Player Bar -->
  <section class="mini" id="mini">
    <div class="miniLeft">
      <div class="miniTitle" id="miniTitle">â€”</div>
      <div class="miniMeta" id="miniMeta">â€”</div>
    </div>

    <div class="miniMid">
      <div class="miniBtns">
        <button class="btn pill" id="prevBtn" type="button" title="Ø§Ù„Ø³Ø§Ø¨Ù‚">âŸµ</button>
        <button class="btn primary pill" id="playBtn" type="button" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù">â–¶</button>
        <button class="btn pill" id="nextBtn" type="button" title="Ø§Ù„ØªØ§Ù„ÙŠ">âŸ¶</button>
      </div>
      <div class="miniToggles">
        <button class="btn pill" id="shuffleBtn" type="button" title="Shuffle">ğŸ”€</button>
        <button class="btn pill" id="repeatBtn" type="button" title="Repeat">ğŸ”</button>
      </div>
    </div>

    <div class="miniRight">
      <label class="volWrap" title="Ø§Ù„ØµÙˆØª">
        <span class="volIco">ğŸ”Š</span>
        <input id="volRange" class="volRange" type="range" min="0" max="100" step="1" value="70">
      </label>
    </div>
  </section>

  <script>
"use strict";

/* ========= Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ ========= */
const YT_API_KEY = "AIzaSyD3mvCx80XsvwrURRg2RwaD8HmOKqhYkek";

const PLAYLISTS = {
  rap: "PL2FIA-SoBgYtotc48ZfKSYagxMd3AMmVp",
  sad: "PL2FIA-SoBgYvY4B-0IDWTtKriVGPb1qnx",
};

const LINKS = {
  youtube: "https://youtube.com/@f90-music?si=VnsVH56lT7UV8N4n",
  tiktok:  "https://www.tiktok.com/@f90.business?_r=1&_t=ZS-91tnkFox3hp",
  insta:   "https://www.instagram.com/f90_yt?igsh=MWxmM2ttYjVwZnN4bQ==",
  whatsapp:"https://wa.me/970568181910",
  email:   "mailto:f90gimme@gmail.com",
};

const THEMES = [
  { id:"neon",   name:"Neon"   },
  { id:"cyan",   name:"Cyan"   },
  { id:"purple", name:"Purple" },
  { id:"gold",   name:"Gold"   },
  { id:"red",    name:"Red"    },
  { id:"green",  name:"Green"  },
  { id:"mono",   name:"Mono"   },
];

/* ========= Ø£Ø¯ÙˆØ§Øª ========= */
const $ = (id)=>document.getElementById(id);
const escapeHtml = (s)=>String(s ?? "")
  .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
  .replaceAll('"',"&quot;").replaceAll("'","&#039;");
const fmtDate = (iso)=> new Date(iso).toLocaleDateString("ar", {year:"numeric", month:"short", day:"numeric"});
const safeText = (el, v)=>{ if(el) el.textContent = v; };

function setHrefAll(k, url){
  document.querySelectorAll(`[data-link="${k}"]`).forEach(a=>a.setAttribute("href", url));
}
function injectLinks(){
  Object.keys(LINKS).forEach(k=> setHrefAll(k, LINKS[k]));
}

/* ========= ØªØ®Ø²ÙŠÙ† ========= */
const STORE_KEY    = "f90_player_state_v4";
const THEME_KEY    = "f90_theme_v1";
const MOTION_KEY   = "f90_motion_v1";
const FAV_KEY      = "f90_favs_v1";
const MODE_KEY     = "f90_mode_v1";
const CONTRAST_KEY = "f90_contrast_v1";
const VOLUME_KEY   = "f90_volume_v1";
const SHUFFLE_KEY  = "f90_shuffle_v1";
const REPEAT_KEY   = "f90_repeat_v1";
const CACHE_KEY    = "f90_track_cache_v1";

function savePlayerState(obj){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(obj)); }catch{} }
function loadPlayerState(){ try{ return JSON.parse(localStorage.getItem(STORE_KEY)||"null"); }catch{ return null; } }

function getTheme(){ return localStorage.getItem(THEME_KEY) || "neon"; }
function setTheme(t){
  const ok = THEMES.find(x=>x.id===t) ? t : "neon";
  document.documentElement.setAttribute("data-theme", ok);
  try{ localStorage.setItem(THEME_KEY, ok); }catch{}
}
function getMotion(){ return localStorage.getItem(MOTION_KEY) || "on"; }
function setMotion(v){
  const val = (v==="off") ? "off" : "on";
  document.documentElement.setAttribute("data-motion", val);
  try{ localStorage.setItem(MOTION_KEY, val); }catch{}
}
function getMode(){ return localStorage.getItem(MODE_KEY) || "night"; }
function setMode(v){
  const val = (v==="day") ? "day" : "night";
  document.documentElement.setAttribute("data-mode", val);
  try{ localStorage.setItem(MODE_KEY, val); }catch{}
}
function getContrast(){ return localStorage.getItem(CONTRAST_KEY) || "normal"; }
function setContrast(v){
  const val = (v==="high") ? "high" : "normal";
  document.documentElement.setAttribute("data-contrast", val);
  try{ localStorage.setItem(CONTRAST_KEY, val); }catch{}
}
function getVolume(){
  const n = Number(localStorage.getItem(VOLUME_KEY) ?? 70);
  return Number.isFinite(n) ? Math.max(0, Math.min(100, n)) : 70;
}
function setVolume(v){
  const n = Math.max(0, Math.min(100, Number(v)||0));
  try{ localStorage.setItem(VOLUME_KEY, String(n)); }catch{}
  return n;
}
function getShuffle(){ return (localStorage.getItem(SHUFFLE_KEY) || "0") === "1"; }
function setShuffle(on){ try{ localStorage.setItem(SHUFFLE_KEY, on ? "1":"0"); }catch{} }
function getRepeat(){ return (localStorage.getItem(REPEAT_KEY) || "0") === "1"; }
function setRepeat(on){ try{ localStorage.setItem(REPEAT_KEY, on ? "1":"0"); }catch{} }

/* ========= Favorites ========= */
function loadFavs(){
  try{
    const raw = localStorage.getItem(FAV_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr : [];
  }catch{ return []; }
}
function saveFavs(arr){ try{ localStorage.setItem(FAV_KEY, JSON.stringify(arr)); }catch{} }
function isFav(id){ return loadFavs().includes(id); }
function toggleFav(id){
  const arr = loadFavs();
  const i = arr.indexOf(id);
  if(i >= 0) arr.splice(i,1); else arr.unshift(id);
  const uniq = Array.from(new Set(arr)).slice(0, 500);
  saveFavs(uniq);
  return uniq.includes(id);
}

/* ========= Ratings (local) ========= */
function ratingKey(videoId){ return `f90_rate_${videoId}`; }
function getRating(videoId){ try{ return Number(localStorage.getItem(ratingKey(videoId)) || 0); }catch{ return 0; } }
function setRating(videoId, val){
  const v = Math.max(1, Math.min(5, Number(val||0)));
  try{ localStorage.setItem(ratingKey(videoId), String(v)); }catch{}
}
function computeTopRatedText(all){
  let best = 0;
  (all||[]).forEach(t=>{ best = Math.max(best, getRating(t.id)); });
  return best ? `${best}/5` : "â€”";
}

/* ========= Comments (local) ========= */
function commentsKey(videoId){ return `f90_cm_${videoId}`; }
function loadComments(videoId){
  try{
    const raw = localStorage.getItem(commentsKey(videoId));
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr : [];
  }catch{ return []; }
}
function saveComments(videoId, arr){ try{ localStorage.setItem(commentsKey(videoId), JSON.stringify(arr)); }catch{} }

/* ========= Cache ========= */
function loadCache(){
  try{ return JSON.parse(localStorage.getItem(CACHE_KEY) || "{}") || {}; }catch{ return {}; }
}
function saveCache(obj){
  try{ localStorage.setItem(CACHE_KEY, JSON.stringify(obj)); }catch{}
}

/* ========= State ========= */
const state = {
  rap: [],
  sad: [],
  all: [],
  currentListName: "all",
  currentList: [],
  lastRenderedIds: [],
};

/* ========= YouTube API ========= */
async function ytFetchJson(url){
  const r = await fetch(url);
  const txt = await r.text();
  let data = null;
  try{ data = JSON.parse(txt); }catch{ data = { raw: txt }; }
  if(!r.ok){
    const msg = data?.error?.message || `HTTP ${r.status}`;
    throw new Error(msg);
  }
  return data;
}
async function getAllPlaylistItems(playlistId){
  let items = [];
  let pageToken = "";
  while(true){
    const url =
      `https://www.googleapis.com/youtube/v3/playlistItems` +
      `?part=snippet,contentDetails&maxResults=50` +
      `&playlistId=${encodeURIComponent(playlistId)}` +
      `&pageToken=${encodeURIComponent(pageToken)}` +
      `&key=${encodeURIComponent(YT_API_KEY)}`;

    const data = await ytFetchJson(url);

    const chunk = (data.items || []).map(it=>{
      const id = it.contentDetails?.videoId;
      const title = it.snippet?.title || "";
      const publishedAt = it.contentDetails?.videoPublishedAt || it.snippet?.publishedAt || "";
      const thumb = it.snippet?.thumbnails?.high?.url || it.snippet?.thumbnails?.medium?.url || "";
      return { id, title, publishedAt, thumb };
    }).filter(v=> v.id && v.title && v.title !== "Private video" && v.title !== "Deleted video");

    items.push(...chunk);
    if(!data.nextPageToken) break;
    pageToken = data.nextPageToken;
  }
  const m = new Map();
  items.forEach(v=>{ if(!m.has(v.id)) m.set(v.id,v); });
  return Array.from(m.values());
}

/* ========= Drawer ========= */
function bindDrawer(){
  const drawerBtn = $("drawerBtn");
  const drawer    = $("drawer");
  const overlay   = $("drawerOverlay");
  const closeBtn  = $("closeDrawer");
  if(!drawer || !overlay) return;

  const open = ()=>{ drawer.classList.add("open"); overlay.classList.add("open"); document.body.style.overflow="hidden"; };
  const close= ()=>{ drawer.classList.remove("open"); overlay.classList.remove("open"); document.body.style.overflow=""; };

  close();

  drawerBtn?.addEventListener("click",(e)=>{ e.preventDefault(); e.stopPropagation(); open(); });
  closeBtn?.addEventListener("click",(e)=>{ e.preventDefault(); e.stopPropagation(); close(); });

  overlay.addEventListener("pointerdown",(e)=>{ e.preventDefault(); e.stopPropagation(); close(); }, true);
  drawer.addEventListener("click",(e)=>{ if(e.target.closest("a")) close(); }, true);
  window.addEventListener("hashchange", close);
  document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") close(); });

  document.addEventListener("pointerdown",(e)=>{
    if(!drawer.classList.contains("open")) return;
    if(e.target.closest("#drawer")) return;
    if(e.target.closest("#drawerBtn")) return;
    close();
  }, true);
}

/* ========= Theme Modal ========= */
function buildThemeModal(){
  const grid = $("themeGrid");
  if(!grid) return;
  grid.innerHTML = THEMES.map(t=>`
    <button class="themeSwatch" type="button" data-theme="${escapeHtml(t.id)}">
      <div class="swTop">
        <div class="swName">${escapeHtml(t.name)}</div>
        <div class="swDot"></div>
      </div>
      <div class="swBar"></div>
    </button>
  `).join("");
  grid.querySelectorAll(".themeSwatch").forEach(btn=>{
    const id = btn.getAttribute("data-theme");
    btn.addEventListener("click", ()=>{
      setTheme(id);
      closeThemeModal();
    });
  });
}
function openThemeModal(){ $("themeOverlay")?.classList.add("open"); $("themeModal")?.classList.add("open"); }
function closeThemeModal(){ $("themeOverlay")?.classList.remove("open"); $("themeModal")?.classList.remove("open"); }
function bindThemeUI(){
  buildThemeModal();
  $("themeBtn")?.addEventListener("click", openThemeModal);
  $("closeTheme")?.addEventListener("click", closeThemeModal);
  $("themeOverlay")?.addEventListener("pointerdown", closeThemeModal, true);
  $("motionBtn")?.addEventListener("click", ()=>{
    const cur = document.documentElement.getAttribute("data-motion") || "on";
    setMotion(cur === "on" ? "off" : "on");
  });
}

/* ========= Mode/Contrast ========= */
function refreshModeButtons(){
  const mode = document.documentElement.getAttribute("data-mode") || "night";
  const contrast = document.documentElement.getAttribute("data-contrast") || "normal";
  const modeBtn = $("modeBtn");
  const contrastBtn = $("contrastBtn");
  if(modeBtn){
    modeBtn.textContent = (mode === "day") ? "Ù„ÙŠÙ„ÙŠ" : "Ù†Ù‡Ø§Ø±ÙŠ";
    modeBtn.classList.toggle("on", mode === "day");
  }
  if(contrastBtn){
    contrastBtn.textContent = (contrast === "high") ? "Ø¹Ø§Ø¯ÙŠ" : "ØªØ¨Ø§ÙŠÙ†";
    contrastBtn.classList.toggle("on", contrast === "high");
  }
}
function bindModeContrast(){
  $("modeBtn")?.addEventListener("click", ()=>{
    const cur = getMode();
    setMode(cur === "day" ? "night" : "day");
    refreshModeButtons();
  });
  $("contrastBtn")?.addEventListener("click", ()=>{
    const cur = getContrast();
    setContrast(cur === "high" ? "normal" : "high");
    refreshModeButtons();
  });
}

/* ========= Router + Views ========= */
function showIndex(){
  $("indexApp")?.style && ($("indexApp").style.display = "");
  $("songView")?.classList.remove("show");
}
function showSong(){
  $("indexApp")?.style && ($("indexApp").style.display = "none");
  $("songView")?.classList.add("show");
}

function updateHeader(view){
  const map = {
    home:["Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©","ÙˆØ§Ø¬Ù‡Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©"],
    all:["ÙƒÙ„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ","ÙƒÙ„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª"],
    rap:["Ø§Ù„Ø±Ø§Ø¨","Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø§Ø¨"],
    sad:["Ø±ÙˆÙ…Ù†Ø³ÙŠ/Ø­Ø²ÙŠÙ†/Ø·Ø±Ø¨ÙŠ","Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©"],
    fav:["Ù…ÙØ¶Ù„ØªÙŠ","Ø§Ù„Ø£ØºØ§Ù†ÙŠ Ø§Ù„ØªÙŠ Ø­ÙØ¸ØªÙ‡Ø§"],
    top:["Ø£ÙØ¶Ù„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ","Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹"],
  };
  const t = map[view] || ["F90","â€”"];
  safeText($("viewTitle"), t[0]);
  safeText($("viewSubtitle"), t[1]);
}

function setCurrentList(name){
  state.currentListName = name;
  if(name==="rap") state.currentList = state.rap.slice();
  else if(name==="sad") state.currentList = state.sad.slice();
  else if(name==="fav"){
    const favs = loadFavs();
    const map = new Map(state.all.map(x=>[x.id,x]));
    state.currentList = favs.map(id=>map.get(id)).filter(Boolean);
  } else if(name==="top"){
    const base = state.all.slice();
    base.sort((a,b)=> (getRating(b.id)||0) - (getRating(a.id)||0));
    state.currentList = base;
  } else state.currentList = state.all.slice();
}

function renderGrid(list){
  const grid = $("grid");
  if(!grid) return;
  state.lastRenderedIds = list.map(x=>x.id);

  if(!list.length){
    grid.innerHTML = `<div class="sideCard" style="margin:18px"><div class="sideCardTitle">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØºØ§Ù†ÙŠ Ù„Ø¹Ø±Ø¶Ù‡Ø§</div></div>`;
    return;
  }

  grid.innerHTML = list.map(t=>{
    const r = getRating(t.id);
    const fav = isFav(t.id) ? `<span class="badge">â­ Ù…ÙØ¶Ù„Ø©</span>` : "";
    const rate = r ? `<span class="badge">â­ ${r}/5</span>` : "";
    return `
      <article class="item" data-id="${escapeHtml(t.id)}">
        <img class="thumb" src="${escapeHtml(t.thumb)}" alt="" loading="lazy">
        <div class="itemBody">
          <p class="itemTitle">${escapeHtml(t.title)}</p>
          <p class="itemMeta">${escapeHtml(fmtDate(t.publishedAt))} ${rate} ${fav}</p>
        </div>
      </article>
    `;
  }).join("");

  grid.querySelectorAll(".item").forEach(el=>{
    el.addEventListener("click", ()=>{
      const id = el.getAttribute("data-id");
      openSong(id, true);
    });
  });
}

function renderLatestRow(){
  const row = $("latestRow");
  if(!row) return;
  const latest = state.all.slice(0,6);

  row.innerHTML = latest.map(t=>`
    <article class="rowCard" data-id="${escapeHtml(t.id)}">
      <img class="rowThumb" src="${escapeHtml(t.thumb)}" alt="" loading="lazy">
      <div class="rowBody">
        <p class="rowTitle">${escapeHtml(t.title)}</p>
        <p class="rowMeta">${escapeHtml(fmtDate(t.publishedAt))}</p>
      </div>
    </article>
  `).join("");

  row.querySelectorAll(".rowCard").forEach(el=>{
    el.addEventListener("click", ()=>{
      const id = el.getAttribute("data-id");
      state.currentListName = "all";
      state.currentList = state.all.slice();
      state.lastRenderedIds = state.all.map(x=>x.id);
      openSong(id, true);
    });
  });
}

function renderTopRow(){
  const row = $("topRow");
  if(!row) return;
  const base = state.all.slice();
  base.sort((a,b)=> (getRating(b.id)||0) - (getRating(a.id)||0));
  const top = base.slice(0,6);

  row.innerHTML = top.map(t=>`
    <article class="rowCard" data-id="${escapeHtml(t.id)}">
      <img class="rowThumb" src="${escapeHtml(t.thumb)}" alt="" loading="lazy">
      <div class="rowBody">
        <p class="rowTitle">${escapeHtml(t.title)}</p>
        <p class="rowMeta">â­ ${(getRating(t.id)||0)}/5</p>
      </div>
    </article>
  `).join("");

  row.querySelectorAll(".rowCard").forEach(el=>{
    el.addEventListener("click", ()=>{
      const id = el.getAttribute("data-id");
      const list = state.all.slice().sort((a,b)=> (getRating(b.id)||0) - (getRating(a.id)||0));
      state.currentListName = "top";
      state.currentList = list;
      state.lastRenderedIds = list.map(x=>x.id);
      openSong(id, true);
    });
  });
}

function applySearchSort(){
  const q = ($("searchInput")?.value || "").trim().toLowerCase();
  const sort = $("sortSelect")?.value || "date_desc";

  let list = state.currentList.slice();
  if(q) list = list.filter(x=>x.title.toLowerCase().includes(q));

  if(sort === "date_desc") list.sort((a,b)=> new Date(b.publishedAt)-new Date(a.publishedAt));
  if(sort === "date_asc")  list.sort((a,b)=> new Date(a.publishedAt)-new Date(b.publishedAt));
  if(sort === "title_asc") list.sort((a,b)=> a.title.localeCompare(b.title));
  if(sort === "rating_desc") list.sort((a,b)=> (getRating(b.id)||0) - (getRating(a.id)||0));

  renderGrid(list);
}

function route(){
  const h = location.hash || "#/home";
  if(h.startsWith("#/song/")){
    const id = h.replace("#/song/","");
    openSong(id, false);
    return;
  }

  showIndex();

  const view = h.replace("#/","").split("/")[0] || "home";
  updateHeader(view);

  const homePro = $("homePro");
  const toolbar = $("toolbar");
  const backBtn = $("backBtnIndex");

  if(backBtn){
    if(view === "home") backBtn.classList.remove("show");
    else backBtn.classList.add("show");
  }

  if(homePro) homePro.style.display = (view==="home") ? "" : "none";
  if(toolbar) toolbar.style.display = (view==="home") ? "none" : "";

  if(view==="rap") setCurrentList("rap");
  else if(view==="sad") setCurrentList("sad");
  else if(view==="fav") setCurrentList("fav");
  else if(view==="top") setCurrentList("top");
  else setCurrentList("all");

  if(view==="home"){
    renderLatestRow();
    renderTopRow();
    return;
  }
  applySearchSort();
}

/* ========= Song View ========= */
function renderStars(videoId){
  const box = $("stars");
  const txt = $("rateText");
  if(!box) return;

  const cur = getRating(videoId) || 0;
  if(txt) txt.textContent = cur ? `ØªÙ‚ÙŠÙŠÙ…Ùƒ: ${cur}/5` : "Ù„Ù… ØªÙ‚ÙŠÙ… Ø¨Ø¹Ø¯";

  box.innerHTML = [1,2,3,4,5].map(n=>`
    <button class="starBtn ${cur===n ? "active":""}" type="button" data-v="${n}">â˜…</button>
  `).join("");

  box.querySelectorAll(".starBtn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const v = Number(btn.getAttribute("data-v")||0);
      setRating(videoId, v);
      renderStars(videoId);
      renderTopRow();
      safeText($("topRated"), computeTopRatedText(state.all));
    });
  });
}

function timeAgo(ts){
  const d = Date.now() - ts;
  const m = Math.floor(d/60000);
  if(m < 1) return "Ø§Ù„Ø¢Ù†";
  if(m < 60) return `Ù‚Ø¨Ù„ ${m} Ø¯`;
  const h = Math.floor(m/60);
  if(h < 24) return `Ù‚Ø¨Ù„ ${h} Ø³`;
  const day = Math.floor(h/24);
  return `Ù‚Ø¨Ù„ ${day} ÙŠÙˆÙ…`;
}

function renderComments(videoId){
  const list = $("cmList");
  const count = $("cmCount");
  if(!list) return;

  const arr = loadComments(videoId).slice().sort((a,b)=>b.ts-a.ts);
  if(count) count.textContent = `${arr.length} ØªØ¹Ù„ÙŠÙ‚`;

  if(!arr.length){
    list.innerHTML = `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯.</div>`;
    return;
  }

  list.innerHTML = arr.map((c, idx)=>`
    <div class="cmItem">
      <div class="cmTop">
        <div>
          <div class="cmName">${escapeHtml(c.name || "Ø²Ø§Ø¦Ø±")}</div>
          <div class="cmTime">${escapeHtml(timeAgo(c.ts))}</div>
        </div>
        <button class="btn pill cmDel" type="button" data-i="${idx}">Ø­Ø°Ù</button>
      </div>
      <div class="cmText">${escapeHtml(c.text || "")}</div>
    </div>
  `).join("");

  list.querySelectorAll(".cmDel").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const i = Number(btn.getAttribute("data-i")||0);
      const fresh = loadComments(videoId).slice().sort((a,b)=>b.ts-a.ts);
      fresh.splice(i,1);
      saveComments(videoId, fresh);
      renderComments(videoId);
    });
  });
}

function renderSuggestions(videoId){
  const grid = $("suggestGrid");
  if(!grid) return;

  const saved = loadPlayerState() || {};
  const listIds = Array.isArray(saved.listIds) ? saved.listIds : [];
  const curIndex = listIds.indexOf(videoId);

  const picks = [];
  for(let step=1; step<=8; step++){
    const i1 = curIndex + step;
    const i2 = curIndex - step;
    if(i1 >= 0 && i1 < listIds.length) picks.push(listIds[i1]);
    if(i2 >= 0 && i2 < listIds.length) picks.push(listIds[i2]);
    if(picks.length >= 6) break;
  }

  if(!picks.length){
    grid.innerHTML = `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
    return;
  }

  const cache = loadCache();
  const cards = picks.map(id=>{
    const it = cache[id] || null;
    return { id, title: it?.title || "â€”", thumb: it?.thumb || "" };
  });

  grid.innerHTML = cards.map(t=>`
    <article class="sCard" data-id="${escapeHtml(t.id)}">
      ${t.thumb ? `<img class="sThumb" src="${escapeHtml(t.thumb)}" alt="" loading="lazy">` : `<div class="sThumb"></div>`}
      <div class="sBody">
        <p class="sTitle">${escapeHtml(t.title)}</p>
        <p class="sMeta">ÙØªØ­</p>
      </div>
    </article>
  `).join("");

  grid.querySelectorAll(".sCard").forEach(el=>{
    el.addEventListener("click", ()=>{
      const id = el.getAttribute("data-id");
      if(!id) return;
      location.hash = `#/song/${encodeURIComponent(id)}`;
    });
  });
}

function openSong(id, pushHash){
  if(!id) return;

  // Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  const listIds = state.lastRenderedIds.length ? state.lastRenderedIds.slice()
    : (state.currentList.length ? state.currentList.map(x=>x.id) : state.all.map(x=>x.id));
  const idx = listIds.indexOf(id);
  savePlayerState({
    currentListName: state.currentListName,
    nowId: id,
    listIds,
    index: idx >= 0 ? idx : 0
  });

  if(pushHash) location.hash = `#/song/${encodeURIComponent(id)}`;

  showSong();

  // Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø´
  const cache = loadCache();
  const it = cache[id] || null;

  safeText($("songTitle"), it?.title || "ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØºÙ†ÙŠØ©");
  safeText($("songMeta"), it?.publishedAt ? fmtDate(it.publishedAt) : "");
  safeText($("songNote"), "");

  // ØªØ´ØºÙŠÙ„ iframe
  const iframe = $("ytPlayer");
  if(iframe){
    iframe.src = `https://www.youtube.com/embed/${encodeURIComponent(id)}?autoplay=1&rel=0&modestbranding=1`;
  }

  // Fav
  const favBtn = $("favBtn");
  const setFavUI = ()=>{
    if(!favBtn) return;
    const on = isFav(id);
    favBtn.textContent = on ? "â­ ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©" : "â­ Ù…ÙØ¶Ù„Ø©";
    favBtn.classList.toggle("on", on);
  };
  setFavUI();
  favBtn?.onclick = ()=>{ toggleFav(id); setFavUI(); };

  // Copy link
  $("copyBtn")?.onclick = async ()=>{
    try{
      await navigator.clipboard.writeText(location.href);
      safeText($("songNote"), "ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·.");
      setTimeout(()=>safeText($("songNote"), ""), 1200);
    }catch{}
  };

  renderStars(id);
  renderComments(id);
  renderSuggestions(id);

  // add comment
  $("cmAdd")?.onclick = ()=>{
    const name = ($("cmName")?.value || "").trim().slice(0, 40);
    const text = ($("cmText")?.value || "").trim().slice(0, 600);
    if(!text) return;
    const arr = loadComments(id);
    arr.unshift({ name, text, ts: Date.now() });
    saveComments(id, arr.slice(0, 200));
    if($("cmText")) $("cmText").value = "";
    renderComments(id);
  };
  $("cmClear")?.onclick = ()=>{
    if($("cmName")) $("cmName").value = "";
    if($("cmText")) $("cmText").value = "";
  };

  updateMini();
}

function updateMini(){
  const saved = loadPlayerState();
  const id = saved?.nowId;
  if(!id){
    safeText($("miniTitle"), "â€”");
    safeText($("miniMeta"), "â€”");
    safeText($("playBtn"), "â–¶");
    return;
  }
  const cache = loadCache();
  const it = cache[id] || null;
  safeText($("miniTitle"), it?.title || "â€”");
  safeText($("miniMeta"), it?.publishedAt ? fmtDate(it.publishedAt) : "â€”");
}

/* ========= Bootstrap ========= */
async function bootstrap(){
  const status = $("homeStatus");
  if(status) status.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ...";

  try{
    const [rap, sad] = await Promise.all([
      getAllPlaylistItems(PLAYLISTS.rap),
      getAllPlaylistItems(PLAYLISTS.sad),
    ]);

    state.rap = rap.sort((a,b)=> new Date(b.publishedAt)-new Date(a.publishedAt));
    state.sad = sad.sort((a,b)=> new Date(b.publishedAt)-new Date(a.publishedAt));

    const m = new Map();
    [...state.rap, ...state.sad].forEach(v=>{ if(!m.has(v.id)) m.set(v.id, v); });
    state.all = Array.from(m.values()).sort((a,b)=> new Date(b.publishedAt)-new Date(a.publishedAt));

    // Ø­ÙØ¸ Ù„Ù„ÙƒØ§Ø´
    const cache = loadCache();
    state.all.forEach(v=>{
      cache[v.id] = { title:v.title, thumb:v.thumb, publishedAt:v.publishedAt };
    });
    saveCache(cache);

    safeText($("totalTracks"), String(state.all.length));
    safeText($("latestTrack"), state.all[0] ? fmtDate(state.all[0].publishedAt) : "â€”");
    safeText($("statsMini"), `${state.all.length} Ø£ØºÙ†ÙŠØ©`);
    safeText($("topRated"), computeTopRatedText(state.all));

    if(status) status.textContent = "";

    if(!location.hash) location.hash = "#/home";
    route();
    updateMini();

  }catch(err){
    console.error(err);
    if(status) status.textContent = `ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØºØ§Ù†ÙŠ: ${err.message}`;
    renderGrid([]);
  }
}

/* ========= Init ========= */
window.addEventListener("load", ()=>{
  const y = new Date().getFullYear();
  ["year","yearF","yearM"].forEach(id=>{ const el=$(id); if(el) el.textContent = y; });

  setTheme(getTheme());
  setMotion(getMotion());
  setMode(getMode());
  setContrast(getContrast());

  injectLinks();
  bindDrawer();
  bindThemeUI();
  bindModeContrast();
  refreshModeButtons();

  $("goHome")?.addEventListener("click", ()=>{ location.hash = "#/home"; });

  document.querySelectorAll("[data-navto]").forEach(b=>{
    b.addEventListener("click", ()=>{ location.hash = b.getAttribute("data-navto"); });
  });

  $("backBtnIndex")?.addEventListener("click", ()=> history.back());
  $("backBtnSong")?.addEventListener("click", ()=> history.back());

  $("refreshBtn")?.addEventListener("click", ()=>bootstrap());
  $("shareBtn")?.addEventListener("click", async ()=>{
    try{
      await navigator.clipboard.writeText(location.href);
      safeText($("homeStatus"), "ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·.");
      setTimeout(()=>safeText($("homeStatus"), ""), 1100);
    }catch{}
  });

  $("searchInput")?.addEventListener("input", applySearchSort);
  $("sortSelect")?.addEventListener("change", applySearchSort);

  // Mini controls
  const vol = $("volRange");
  if(vol){
    vol.value = String(getVolume());
    vol.addEventListener("input", ()=> setVolume(vol.value));
  }
  const sh = $("shuffleBtn");
  const rp = $("repeatBtn");
  const refreshSR = ()=>{
    sh?.classList.toggle("on", getShuffle());
    rp?.classList.toggle("on", getRepeat());
  };
  sh?.addEventListener("click", ()=>{ setShuffle(!getShuffle()); refreshSR(); });
  rp?.addEventListener("click", ()=>{ setRepeat(!getRepeat()); refreshSR(); });
  refreshSR();

  $("playBtn")?.addEventListener("click", ()=>{
    const saved = loadPlayerState();
    const id = saved?.nowId || state.all[0]?.id;
    if(!id) return;
    location.hash = `#/song/${encodeURIComponent(id)}`;
  });

  $("prevBtn")?.addEventListener("click", ()=>{
    const saved = loadPlayerState() || {};
    const listIds = Array.isArray(saved.listIds) ? saved.listIds : state.all.map(x=>x.id);
    if(!listIds.length) return;
    const cur = saved.nowId || listIds[0];
    let idx = listIds.indexOf(cur);
    if(idx < 0) idx = 0;
    const prevIdx = (idx - 1 + listIds.length) % listIds.length;
    const id = listIds[prevIdx];
    savePlayerState({ ...saved, nowId:id, listIds, index: prevIdx });
    location.hash = `#/song/${encodeURIComponent(id)}`;
  });

  $("nextBtn")?.addEventListener("click", ()=>{
    const saved = loadPlayerState() || {};
    const listIds = Array.isArray(saved.listIds) ? saved.listIds : state.all.map(x=>x.id);
    if(!listIds.length) return;
    const cur = saved.nowId || listIds[0];
    let idx = listIds.indexOf(cur);
    if(idx < 0) idx = 0;
    const nextIdx = (idx + 1) % listIds.length;
    const id = listIds[nextIdx];
    savePlayerState({ ...saved, nowId:id, listIds, index: nextIdx });
    location.hash = `#/song/${encodeURIComponent(id)}`;
  });

  window.addEventListener("hashchange", route);

  bootstrap();
});
  </script>
</body>
</html>
